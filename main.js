(()=>{"use strict";var e=function(e){return e.filter((function(e){return!0===e.validity.valid})).length===e.length},t=document.querySelectorAll(".popup"),n=document.querySelector("#photo-viewier"),o=function(e){"Escape"===e.key&&r(document.querySelector(".popup_open"))}.bind();function r(e){document.removeEventListener("keydown",o),e.classList.remove("popup_open")}function c(e){document.addEventListener("keydown",o),e.classList.add("popup_open")}var i,a={baseUrl:"https://nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"200c38ce-1a1c-4131-9fd9-c0901ac5e0ba","Content-Type":"application/json"}},u=document.querySelector("#card-item-template").content,l=document.querySelector("#photo-viewier"),s=l.querySelector(".photo-veiwier__image"),d=l.querySelector(".photo-viewier__caption"),f=document.querySelector("#deleteCard"),m=function(e){var t,n=e.target.parentNode.parentNode.parentNode,o=n.id,r=n.querySelector(".card-item__likes-count");e.target.classList.contains("card-item__button_active")?(t=o,fetch("".concat(a.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(t){e.target.classList.remove("card-item__button_active"),r.textContent=t.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(o).then((function(t){e.target.classList.add("card-item__button_active"),r.textContent=t.likes.length})).catch((function(e){console.log(e)}))},v=function(e){var t=e.target.closest(".card-item");i=t.id,c(f)};function p(e,t,n,o,r,i){var a=u.querySelector(".card-item").cloneNode(!0),f=a.querySelector(".card-item__img"),p=a.querySelector(".card-item__name"),_=a.querySelector("#card-item__like-button"),y=a.querySelector(".card-item__button_type_delete-card"),h=a.querySelector(".card-item__likes-count");return p.textContent=e,a.id=r,f.src=t,f.alt=e,h.textContent=n,_.addEventListener("click",m),f.addEventListener("click",(function(){!function(e,t){s.src=e,s.alt=t,d.textContent=t,c(l)}(t,e)})),o!==i?y.classList.add("card-item__button_delete-unactive"):y.addEventListener("click",v),a}var _,y=function(e){e.reset()},h=document.querySelector("#editProfile"),S=document.querySelector(".profile__button_type_edit-profile"),b=document.querySelector(".popup__button"),q=h.querySelector("#userName"),k=document.querySelector(".profile__name"),E=h.querySelector("#user-field-of-activity"),L=document.querySelector(".profile__field-of-activity"),g=h.querySelector(".edit-form"),C=document.querySelector(".cards-container"),P=document.querySelector("#addCard"),x=document.querySelector(".profile__button_type_add"),j=P.querySelector("#addCardPopupBtn"),w=P.querySelector(".edit-form"),F=document.querySelector("#photo-viewier"),N=F.querySelector("#photo-viewier-close-btn"),A=P.querySelector("#card-name"),U=P.querySelector("#card-link"),O=document.querySelector(".profile__name"),B=document.querySelector(".profile__field-of-activity"),T=document.querySelector(".profile__avatar"),D=document.querySelector(".profile__avatar-wrapper"),J=document.querySelector("#editAvatar"),H=J.querySelector(".edit-form"),z=document.querySelector("#deleteCard"),I=z.querySelector(".edit-form"),M=function(e,t){e.querySelector(".edit-form__button").textContent=t};var G;Promise.all([fetch("".concat(a.baseUrl,"/users/me"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),fetch("".concat(a.baseUrl,"/cards"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){var t=e[0],n=e[1];_=t._id,O.textContent=t.name,B.textContent=t.about,T.src=t.avatar,n.forEach((function(e){return C.append(p(e.name,e.link,e.likes.length,e.owner._id,e._id,_))}))})).catch((function(e){console.log(e)})),S.addEventListener("click",(function(){q.value=k.textContent,E.value=L.textContent,c(h)})),b.addEventListener("click",(function(){r(h)})),g.addEventListener("submit",(function(e){!function(e,t){var n,o,c;e.preventDefault(),M(h,"Сохранение..."),(n={name:t.userNameFromPopup.value,about:t.userFieldOfActivityFromPopup.value},o=n.name,c=n.about,fetch("".concat(a.baseUrl,"/users/me"),{method:"PATCH",headers:a.headers,body:JSON.stringify({name:o,about:c})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){t.userNameFromProfile.textContent=e.name,t.userFieldOfActivityFromProfile.textContent=e.about,r(t.editProfilePopup)})).finally((function(){M(h,"Сохранить")})).catch((function(e){console.log(e)}))}(e,{userNameFromProfile:k,userNameFromPopup:q,userFieldOfActivityFromProfile:L,userFieldOfActivityFromPopup:E,editProfilePopup:h})})),x.addEventListener("click",(function(){P.querySelector(".edit-form__button").classList.add("edit-form__button_disabled"),c(P)})),j.addEventListener("click",(function(){r(P)})),w.addEventListener("submit",(function(e){return function(e,t,n){var o,c,i;e.preventDefault(),M(P,"Сохранение..."),(o={name:A.value,link:U.value},c=o.name,i=o.link,fetch("".concat(a.baseUrl,"/cards"),{method:"POST",headers:a.headers,body:JSON.stringify({name:c,link:i})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){t.prepend(p(e.name,e.link,e.likes.length,e.owner._id,e._id,_)),r(P),y(n)})).finally((function(){M(P,"Создать")})).catch((function(e){console.log(e)}))}(e,C,w)})),N.addEventListener("click",(function(){r(n)})),G={formSelector:".edit-form",inputSelector:".edit-form__input",submitButtonSelector:".edit-form__button",inactiveButtonClass:"edit-form__button_disabled",inputErrorClass:"edit-form__input_error",errorClass:"edit-form__input__signature_active"},document.querySelectorAll(G.formSelector).forEach((function(t){var n=Array.from(t.querySelectorAll(G.inputSelector)),o=t.querySelector(G.submitButtonSelector);n.forEach((function(t){t.addEventListener("input",(function(){!function(t,n,o,r){t.validity.valid?(function(e,t,n){e.classList.remove(t);var o=null==e?void 0:e.nextSibling.nextElementSibling;o.classList.remove(n),o.textContent=""}(t,r.inputErrorClass,r.errorClass),e(n)&&(o.classList.remove(r.inactiveButtonClass),o.disabled=!1)):(function(e,t,n,o){e.classList.add(n);var r=e.nextSibling.nextElementSibling;r.textContent=t,r.classList.add(o)}(t,t.validationMessage,r.inputErrorClass,r.errorClass),e(n)||(o.classList.add(r.inactiveButtonClass),o.disabled=!0))}(t,n,o,G)}))})),t.addEventListener("click",(function(e){e.stopPropagation()}))})),t.forEach((function(e){return e.addEventListener("click",(function(){return r(e)}))})),D.addEventListener("click",(function(){c(J)})),H.addEventListener("submit",(function(e){e.preventDefault(),M(J,"Сохранение...");var t=J.querySelector(".edit-form__input").value,n=J.querySelector(".edit-form");(function(e){return fetch("".concat(a.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(t).then((function(e){T.src=e.avatar,r(J),y(n)})).finally((function(){M(J,"Сохранить")})).catch((function(e){console.log(e)}))})),I.addEventListener("submit",(function(e){e.preventDefault();var t,n=document.getElementById("".concat(i));(t=i,fetch("".concat(a.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){n.remove(),r(z)})).catch((function(e){console.log(e)}))})),F.querySelector(".photo-viewier").addEventListener("click",(function(e){return e.stopPropagation()}))})();